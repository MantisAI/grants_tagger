schema: '2.0'
stages:
  preprocess_wellcome_science:
    cmd: grants_tagger preprocess wellcome-science data/raw/science_tags_full_version.xlsx
      data/processed/science_grants_tagged_title_synopsis.jsonl
    deps:
    - path: data/raw/science_tags_full_version.xlsx
      md5: 74da2bf7a507e52b8b677ddce19156a9
      size: 2638299
    - path: grants_tagger/preprocess.py
      md5: 959ffb629c7f2c7010052c92c2b18116
      size: 3559
    params:
      params.yaml:
        preprocess_wellcome_science.meta_cols: Grant_ID,Title
        preprocess_wellcome_science.text_cols: Title,Synopsis
    outs:
    - path: data/processed/science_grants_tagged_title_synopsis.jsonl
      md5: 2fb37d57daeece50a0190e16e229647a
      size: 2809039
  train:
    cmd: grants_tagger train data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer.pkl models/tfidf-svm-2020.05.2.pkl --approach tfidf-svm
    deps:
    - path: data/processed/science_grants_tagged_title_synopsis.jsonl
      md5: 2fb37d57daeece50a0190e16e229647a
      size: 2809039
    - path: grants_tagger/train.py
      md5: 162e8650a0a7e970420f48eb5c253f82
      size: 3970
    params:
      params.yaml:
        train.class_weight: balanced
        train.min_df: 5
        train.ngram_range:
        - 1
        - 2
    outs:
    - path: models/label_binarizer.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/tfidf-svm-2020.05.2.pkl
      md5: eceaf3846999e47380ca670c096b810a
      size: 17768856
  train_tfidf_svm:
    cmd: grants_tagger train data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer-2020.05.2.pkl models/tfidf-svm-2020.05.2.pkl --approach
      tfidf-svm
    deps:
    - path: data/processed/science_grants_tagged_title_synopsis.jsonl
      md5: 2fb37d57daeece50a0190e16e229647a
      size: 2809039
    - path: grants_tagger/train.py
      md5: 78683e5785fe5f403b4d1f58211b5dc8
      size: 3971
    params:
      params.yaml:
        train.tfidf-svm.svm__estimator.class_weight: balanced
        train.tfidf-svm.tfidf.min_df: 5
        train.tfidf-svm.tfidf.ngram_range:
        - 1
        - 2
    outs:
    - path: models/label_binarizer-2020.05.2.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/tfidf-svm-2020.05.2.pkl
      md5: c2cb2d67152b2f19dfd09ef75d93179d
      size: 17768857
  evaluate:
    cmd: grants_tagger evaluate model tfidf-svm models/tfidf-svm-2020.05.2.pkl data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer.pkl
    deps:
    - path: grants_tagger/evaluate_model.py
      md5: cd583e8d10e0c889647834cab217ce2f
      size: 1872
    - path: models/label_binarizer.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/tfidf-svm-2020.05.2.pkl
      md5: f24b224be6a867f96400b3df2ad26ac9
      size: 17768856
    outs:
    - path: results.json
      md5: 1d0d4fb63ae1d1b911373cc558147737
      size: 89
  evaluate_tfidf_svm:
    cmd: grants_tagger evaluate model tfidf-svm models/tfidf-svm-2020.05.2.pkl data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer.pkl --results-path results/tfidf_svm.json
    deps:
    - path: grants_tagger/evaluate_model.py
      md5: f44b129408d66916e59c881bc777db87
      size: 1908
    - path: models/label_binarizer-2020.05.2.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/tfidf-svm-2020.05.2.pkl
      md5: c2cb2d67152b2f19dfd09ef75d93179d
      size: 17768857
    outs:
    - path: results/tfidf_svm.json
      md5: 1d0d4fb63ae1d1b911373cc558147737
      size: 89
  train_scibert:
    cmd: grants_tagger train data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer-2020.05.5.pkl models/scibert-2020.05.5 --approach scibert
    deps:
    - path: data/processed/science_grants_tagged_title_synopsis.jsonl
      md5: 2fb37d57daeece50a0190e16e229647a
      size: 2809039
    - path: grants_tagger/train.py
      md5: 78683e5785fe5f403b4d1f58211b5dc8
      size: 3971
    params:
      params.yaml:
        train.scibert.epochs: 10
        train.scibert.learning_rate: 2e-05
        train.scibert.validation_split: 0.1
    outs:
    - path: models/label_binarizer-2020.05.5.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/scibert-2020.05.5
      md5: 6431d90a5c2a9a7fe4519ffc9c4216d8.dir
      size: 440019948
      nfiles: 2
  evaluate_scibert:
    cmd: grants_tagger evaluate model scibert models/scibert-2020.05.5 data/processed/science_grants_tagged_title_synopsis.jsonl
      models/label_binarizer-2020.05.5.pkl --results-path results/scibert.json
    deps:
    - path: grants_tagger/evaluate_model.py
      md5: f44b129408d66916e59c881bc777db87
      size: 1908
    - path: models/label_binarizer-2020.05.5.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/scibert-2020.05.5
      md5: 6431d90a5c2a9a7fe4519ffc9c4216d8.dir
      size: 440019948
      nfiles: 2
    outs:
    - path: results/scibert.json
      md5: e3ccf07bfd0e4a7ba8ed5215da1db9f0
      size: 88
  preprocess_bioasq_mesh:
    cmd: grants_tagger preprocess bioasq-mesh data/raw/allMeSH_2020.json data/processed/disease_mesh.jsonl
      --mesh-metadata-path data/raw/desc2020.xml
    deps:
    - path: data/raw/allMeSH_2020.json
      md5: ab9c0fef793ca03c0a3984c3194925eb
      size: 26219751317
    - path: data/raw/desc2020.xml
      md5: 0ded6315fca9d03a2712bd55c85f6e3c
      size: 295102741
    - path: grants_tagger/preprocess_mesh.py
      md5: 49b176f0a97416d3cddf5282a9968a48
      size: 3813
    outs:
    - path: data/processed/disease_mesh.jsonl
      md5: de5f70c61a480ff2d0cdba2fe43cbc43
      size: 11482247962
  evaluate_science_ensemble:
    cmd: grants_tagger evaluate model science-ensemble models/tfidf-svm-2020.05.2.pkl,models/scibert-2020.05.5
      data/processed/science_grants_tagged_title_synopsis.jsonl models/label_binarizer-2020.05.2.pkl
      --results-path results/science_ensemble.json
    deps:
    - path: grants_tagger/evaluate_model.py
      md5: f44b129408d66916e59c881bc777db87
      size: 1908
    - path: models/label_binarizer-2020.05.2.pkl
      md5: 220319a004a60bd6475e2fb617c2c1f3
      size: 1067
    - path: models/scibert-2020.05.5
      md5: 6431d90a5c2a9a7fe4519ffc9c4216d8.dir
      size: 440019948
      nfiles: 2
    - path: models/tfidf-svm-2020.05.2.pkl
      md5: c2cb2d67152b2f19dfd09ef75d93179d
      size: 17768857
    outs:
    - path: results/science_ensemble.json
      md5: 59d59d5d555c2b3414d0fb4ed1b6914a
      size: 89
