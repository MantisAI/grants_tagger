schema: '2.0'
stages:
  prepare_data:
    cmd: "python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X.npy\
      \ ../../data//processed/bertmesh/Y.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2019,2019 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n\
      python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X_test.npy\
      \ ../../data//processed/bertmesh/Y_test.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2020,2020 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n"
    deps:
    - path: prepare_data.py
      md5: a451a03eab8e0d9311da13131b3e7fa3
      size: 2007
    params:
      params.yaml:
        prepare_data.years: 2019,2019
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
    outs:
    - path: ../../data//processed/bertmesh/X.npy
      md5: b734201c1044a36e1a1c59f886d0644f
      size: 2660626560
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: 25c4bd0b21cedcf5cfdd3d5d67f64053
      size: 909930624
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 172b71b4e7d2be26a76ca072c7b48e39
      size: 16141305
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: f3c3763c9a75a8425ee12bbcf3b0a6af
      size: 5375745
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 711869c5ef9d5f3dc89da99378f8e36d
      size: 992992
  train:
    cmd: python train_torch.py ../../data//processed/bertmesh/X.npy ../../data//processed/bertmesh/Y.npz
      ../../models//bertmesh/model/ --learning-rate 5e-05 --batch-size 8 --epochs
      5 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract --multilabel-attention
      --hidden-size 1024 --clip-norm 5 --dropout 0.1 --train-metrics-path train_metrics.json
      --warmup-steps 1000 --val-x-path ../../data//processed/bertmesh/X_test.npy --val-y-path
      ../../data//processed/bertmesh/Y_test.npz --experiment-name transformers-bertmesh
      --dry-run
    deps:
    - path: ../../data//processed/bertmesh/X.npy
      md5: b734201c1044a36e1a1c59f886d0644f
      size: 2660626560
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 172b71b4e7d2be26a76ca072c7b48e39
      size: 16141305
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 711869c5ef9d5f3dc89da99378f8e36d
      size: 992992
    - path: model.py
      md5: c771579fa3ae193691df138d23d6410f
      size: 2301
    - path: train_torch.py
      md5: 678293b5dd83a8f7eda963457f9fe4e4
      size: 6524
    params:
      params.yaml:
        train.batch_size: 8
        train.clip_norm: 5
        train.dropout: 0.1
        train.epochs: 5
        train.hidden_size: 1024
        train.learning_rate: 5e-05
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
        train.warmup_steps: 1000
    outs:
    - path: ../../models//bertmesh/model/config.json
      md5: 55b43c72ddb003a1bb6f20e50ebe9938
      size: 1442899
    - path: ../../models//bertmesh/model/pytorch_model.bin
      md5: ea8a0ee9139607b45a0cd1b9ab595e69
      size: 638592291
    - path: train_metrics.json
      md5: 365018aa491e5e1b52df814889517031
      size: 84
  evaluate:
    cmd: python evaluate.py ../../data//processed/bertmesh/X_test.npy ../../data//processed/bertmesh/Y_test.npz
      ../../models//bertmesh/model/ --batch-size 8 --results-path results.json --pr-curve-path
      pr_curve.json --experiment-name transformers-bertmesh --dry-run
    deps:
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: 25c4bd0b21cedcf5cfdd3d5d67f64053
      size: 909930624
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: f3c3763c9a75a8425ee12bbcf3b0a6af
      size: 5375745
    - path: ../../models//bertmesh/model/config.json
      md5: 55b43c72ddb003a1bb6f20e50ebe9938
      size: 1442899
    - path: ../../models//bertmesh/model/pytorch_model.bin
      md5: ea8a0ee9139607b45a0cd1b9ab595e69
      size: 638592291
    - path: evaluate.py
      md5: 06977ea962a3c1c24722e823d32e346e
      size: 2454
    params:
      params.yaml:
        train.batch_size: 8
    outs:
    - path: pr_curve.json
      md5: 990118d5410f58e250b026c9e87620bf
      size: 374
    - path: results.json
      md5: 4331367d6db236c0caab359f4e6b3e69
      size: 42
