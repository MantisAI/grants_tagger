schema: '2.0'
stages:
  prepare_data:
    cmd: "python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X.npy\
      \ ../../data//processed/bertmesh/Y.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2018,2019 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n\
      python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X_test.npy\
      \ ../../data//processed/bertmesh/Y_test.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2020,2021 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n"
    deps:
    - path: prepare_data.py
      md5: a451a03eab8e0d9311da13131b3e7fa3
      size: 2007
    params:
      params.yaml:
        prepare_data.years: 2018,2019
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
    outs:
    - path: ../../data//processed/bertmesh/X.npy
      md5: 45120fcbe393753259b92d36920359a0
      size: 5208608896
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: deca6b5db5d1b8350caca649bd0d9231
      size: 911880320
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 44bde9881191cfd225a4ab4b3f104905
      size: 32027749
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: 97dd4bd766f586ad7b1f9fbef99d8040
      size: 5408930
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 520f700f579ea9c2e9adc430d4701022
      size: 1020403
  train:
    cmd: python train_torch.py ../../data//processed/bertmesh/X.npy ../../data//processed/bertmesh/Y.npz
      ../../models//bertmesh/model.pt --learning-rate 1e-05 --batch-size 64 --epochs
      5 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract --multilabel-attention
      --hidden-size 1024 --clip-norm 5 --dropout 0.1 --train-metrics-path train_metrics.json
      --warmup-steps 1000 --val-x-path ../../data//processed/bertmesh/X_test.npy --val-y-path
      ../../data//processed/bertmesh/Y_test.npz
    deps:
    - path: ../../data//processed/bertmesh/X.npy
      md5: 45120fcbe393753259b92d36920359a0
      size: 5208608896
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 44bde9881191cfd225a4ab4b3f104905
      size: 32027749
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 520f700f579ea9c2e9adc430d4701022
      size: 1020403
    - path: train.py
      md5: 54e8be459c2b194b7318919f754eef37
      size: 3479
    params:
      params.yaml:
        train.batch_size: 64
        train.clip_norm: 5
        train.dropout: 0.1
        train.epochs: 5
        train.hidden_size: 1024
        train.learning_rate: 1e-05
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
        train.warmup_steps: 1000
    outs:
    - path: ../../models//bertmesh/model.pt
      md5: 9adb6c18dde04883aa9161f60279766a
      size: 644011041
    - path: train_metrics.json
      md5: 35eda957a486ff45012eb6edc535ce9b
      size: 73491
  evaluate:
    cmd: python evaluate.py ../../data//processed/bertmesh/X_test.npy ../../data//processed/bertmesh/Y_test.npz
      ../../models//bertmesh/model.pt --batch-size 64 --results-path results.json
    deps:
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: deca6b5db5d1b8350caca649bd0d9231
      size: 911880320
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: 97dd4bd766f586ad7b1f9fbef99d8040
      size: 5408930
    - path: ../../models//bertmesh/model.pt
      md5: 9adb6c18dde04883aa9161f60279766a
      size: 644011041
    - path: evaluate.py
      md5: cd379cda9666c27bd55d76f192acf81c
      size: 1167
    params:
      params.yaml:
        train.batch_size: 64
    outs:
    - path: results.json
      md5: 4d776e96629da326d9a94b7415ff256e
      size: 77
