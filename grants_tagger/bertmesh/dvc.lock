schema: '2.0'
stages:
  prepare_data:
    cmd: "python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X.npy\
      \ ../../data//processed/bertmesh/Y.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2018,2019 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n\
      python prepare_data.py ../../data//processed/train_mesh2021.jsonl ../../data//processed/bertmesh/X_test.npy\
      \ ../../data//processed/bertmesh/Y_test.npz ../../models//bertmesh/label_binarizer.pkl\
      \ --years 2020,2021 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract\n"
    deps:
    - path: prepare_data.py
      md5: f5d5aacd720fdcbb60d7608147f52036
      size: 2006
    params:
      params.yaml:
        prepare_data.years: 2018,2019
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
    outs:
    - path: ../../data//processed/bertmesh/X.npy
      md5: 68bc1e86940cfafca960fa756680eea3
      size: 2547982464
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: 25c4bd0b21cedcf5cfdd3d5d67f64053
      size: 909930624
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 945f6126714c622cef351e9fd9f7f252
      size: 15758882
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: 58b050351390cb111c6e434e2a7a0499
      size: 5344521
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 3491ee5cab1f01d04d3f7aaa4ff35ef1
      size: 986160
  train:
    cmd: python train_torch.py ../../data//processed/bertmesh/X.npy ../../data//processed/bertmesh/Y.npz
      ../../models//bertmesh/model.pt --learning-rate 1e-05 --batch-size 64 --epochs
      1 --pretrained-model microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
    deps:
    - path: ../../data//processed/bertmesh/X.npy
      md5: 68bc1e86940cfafca960fa756680eea3
      size: 2547982464
    - path: ../../data//processed/bertmesh/Y.npz
      md5: 945f6126714c622cef351e9fd9f7f252
      size: 15758882
    - path: ../../models//bertmesh/label_binarizer.pkl
      md5: 3491ee5cab1f01d04d3f7aaa4ff35ef1
      size: 986160
    - path: train.py
      md5: 54e8be459c2b194b7318919f754eef37
      size: 3479
    params:
      params.yaml:
        train.batch_size: 64
        train.epochs: 1
        train.learning_rate: 1e-05
        train.pretrained_model: microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract
    outs:
    - path: ../../models//bertmesh/model.pt
      md5: 8cb75d1f429cab33507b15cc193a71da
      size: 579850017
  evaluate:
    cmd: python evaluate.py ../../data//processed/bertmesh/X_test.npy ../../data//processed/bertmesh/Y_test.npz
      ../../models//bertmesh/model.pt
    deps:
    - path: ../../data//processed/bertmesh/X_test.npy
      md5: 25c4bd0b21cedcf5cfdd3d5d67f64053
      size: 909930624
    - path: ../../data//processed/bertmesh/Y_test.npz
      md5: 58b050351390cb111c6e434e2a7a0499
      size: 5344521
    - path: ../../models//bertmesh/model.pt
      md5: 8cb75d1f429cab33507b15cc193a71da
      size: 579850017
    - path: evaluate.py
      md5: cd379cda9666c27bd55d76f192acf81c
      size: 1167
    outs:
    - path: results.json
      md5: 563d301957d33cce77719c7407676c92
      size: 78
